<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chuva de N√∫meros: Conjuntos</title>
    <!-- Favicon para evitar erro 404 no GitHub -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Fredoka', sans-serif;
            overflow: hidden;
            touch-action: none; /* Crucial para mobile: impede o ecr√£ de arrastar */
            background-color: #1a1a2e;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
        }

        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1rem;
        }

        .modal {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            transition: transform 0.3s ease-out;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .float-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
        }
    </style>
</head>
<body class="text-white h-screen w-screen flex flex-col items-center justify-center">

    <!-- Canvas do Jogo -->
    <canvas id="gameCanvas"></canvas>

    <!-- UI Overlay (Pontos, Vida, Regra Atual) -->
    <div id="gameUI" class="ui-layer hidden">
        <div class="flex justify-between items-start w-full max-w-2xl mx-auto">
            <div class="bg-gray-800 bg-opacity-70 p-3 rounded-lg border border-purple-500 shadow-lg">
                <p class="text-xs text-gray-300 uppercase tracking-widest">Pontos</p>
                <p id="scoreDisplay" class="text-2xl font-bold text-yellow-400">0</p>
            </div>
            
            <div class="flex flex-col items-center flex-1 mx-4">
                <div class="bg-indigo-600 px-6 py-2 rounded-full shadow-lg border-2 border-indigo-400 mb-2 transform hover:scale-105 transition-transform duration-200">
                    <span class="text-xs uppercase tracking-wider font-bold opacity-80">Pegue:</span>
                    <h2 id="currentRuleDisplay" class="text-xl md:text-2xl font-bold text-white leading-none mt-1">Naturais (N)</h2>
                </div>
                <!-- Barra de progresso para troca de regra -->
                <div class="w-full max-w-[12rem] h-3 bg-gray-800 rounded-full overflow-hidden border border-gray-600">
                    <div id="ruleTimerBar" class="h-full bg-gradient-to-r from-yellow-400 to-orange-500 w-full transition-all duration-100 ease-linear"></div>
                </div>
            </div>

            <div class="bg-gray-800 bg-opacity-70 p-3 rounded-lg border border-red-500 shadow-lg">
                <p class="text-xs text-gray-300 uppercase tracking-widest">Vidas</p>
                <div id="livesDisplay" class="text-2xl text-red-500 tracking-widest">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            </div>
        </div>
        
        <!-- Controles Touch (Visual) -->
        <div class="w-full text-center pb-8 text-gray-400 text-sm opacity-60 md:hidden animate-pulse">
            &larr; Deslize para mover &rarr;
        </div>
    </div>

    <!-- Tela Inicial -->
    <div id="startScreen" class="absolute inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-95">
        <div class="modal p-8 rounded-2xl shadow-2xl text-center max-w-md mx-4 text-gray-800 w-full relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
            
            <h1 class="text-4xl font-black mb-1 text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">Chuva Num√©rica</h1>
            <p class="text-gray-500 mb-6 font-medium">O Desafio dos Conjuntos</p>
            
            <div class="bg-indigo-50 p-4 rounded-lg mb-6 text-left text-sm text-gray-700">
                <p class="mb-2 font-bold text-indigo-900">Como jogar:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Observe a regra no topo (ex: "Inteiros").</li>
                    <li>Mova a cesta para pegar os n√∫meros corretos.</li>
                    <li>Evite os n√∫meros que n√£o pertencem ao grupo!</li>
                </ul>
            </div>

            <div class="space-y-3">
                <button onclick="startGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl text-xl shadow-lg transform transition hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2">
                    <span>üéÆ</span> Come√ßar Jogo
                </button>
                
                <button onclick="toggleQRCode(true)" class="w-full bg-white hover:bg-gray-50 text-gray-600 border-2 border-gray-100 font-bold py-3 rounded-xl shadow-sm transition hover:border-gray-300 flex items-center justify-center gap-2">
                    <span>üì±</span> Partilhar Jogo
                </button>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden absolute inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-95">
        <div class="modal p-8 rounded-2xl shadow-2xl text-center max-w-md mx-4 text-gray-800 w-full border-t-8 border-red-500">
            <h2 class="text-3xl font-black mb-2 text-gray-800">Fim de Jogo!</h2>
            
            <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-100">
                <p class="text-sm text-gray-400 uppercase font-bold tracking-wider">Sua Pontua√ß√£o</p>
                <div id="finalScore" class="text-6xl font-black text-indigo-600">0</div>
            </div>

            <div class="space-y-3">
                <button onclick="startGame()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl text-lg shadow-lg transform transition hover:scale-[1.02] flex items-center justify-center gap-2">
                    <span>üîÑ</span> Jogar Novamente
                </button>
            </div>
        </div>
    </div>

    <!-- Modal QR Code -->
    <div id="qrModal" class="hidden absolute inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm">
        <div class="modal p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4 relative">
            <button onclick="toggleQRCode(false)" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full w-8 h-8 flex items-center justify-center font-bold transition">‚úï</button>
            
            <h2 class="text-xl font-bold text-gray-800 mb-2">Partilhar Jogo</h2>
            <p class="text-sm text-gray-500 mb-6">Escaneie para abrir este jogo</p>
            
            <div class="bg-white p-2 rounded-xl border-4 border-indigo-100 inline-block mb-4">
                <img id="qrImage" src="" alt="QR Code" class="w-48 h-48 object-contain">
            </div>
            
            <p class="text-xs text-gray-400 break-all px-4" id="urlDisplay"></p>
        </div>
    </div>

    <script>
        // --- L√≥gica do QR Code ---
        function toggleQRCode(show) {
            const modal = document.getElementById('qrModal');
            const img = document.getElementById('qrImage');
            const urlDisplay = document.getElementById('urlDisplay');
            
            if (show) {
                modal.classList.remove('hidden');
                
                // GitHub Pages Optimization:
                // Se o link terminar em 'index.html', removemos isso para o QR Code ficar mais limpo
                // Ex: .../jogo/index.html vira .../jogo/
                let cleanUrl = window.location.href;
                cleanUrl = cleanUrl.replace(/\/index\.html$/i, '/');

                img.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(cleanUrl)}`;
                urlDisplay.innerText = cleanUrl;
            } else {
                modal.classList.add('hidden');
            }
        }

        // --- GAME ENGINE ---
        // Configura√ß√£o do Canvas e Vari√°veis
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'START'; 
        let score = 0;
        let lives = 3;
        let frameCount = 0;
        let animationId;
        
        // Entidades do Jogo
        const player = {
            x: 0,
            y: 0,
            width: 80, // Valor inicial
            height: 20,
            color: '#A78BFA',
            speed: 0,
            targetX: 0
        };

        // Responsividade do Canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Ajuste Inteligente para Mobile
            if (canvas.width < 768) {
                player.width = 110; 
                player.y = canvas.height - 130; 
            } else {
                player.width = 80; 
                player.y = canvas.height - 100;
            }
            
            if(player.x > canvas.width) player.x = canvas.width/2;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // L√≥gica Matem√°tica (Conjuntos)
        const sets = {
            'N': { name: 'Naturais (‚Ñï)', color: '#4ADE80' }, 
            'Z': { name: 'Inteiros (‚Ñ§)', color: '#60A5FA' }, 
            'Q': { name: 'Racionais (‚Ñö)', color: '#F472B6' }, 
            'I': { name: 'Irracionais (ùïÄ)', color: '#FBBF24' } 
        };

        const numberPool = [
            { text: '0', val: 0, types: ['N', 'Z', 'Q'] },
            { text: '1', val: 1, types: ['N', 'Z', 'Q'] },
            { text: '7', val: 7, types: ['N', 'Z', 'Q'] },
            { text: '15', val: 15, types: ['N', 'Z', 'Q'] },
            { text: '100', val: 100, types: ['N', 'Z', 'Q'] },
            { text: '-1', val: -1, types: ['Z', 'Q'] },
            { text: '-5', val: -5, types: ['Z', 'Q'] },
            { text: '-99', val: -99, types: ['Z', 'Q'] },
            { text: '0,5', val: 0.5, types: ['Q'] },
            { text: '1/2', val: 0.5, types: ['Q'] },
            { text: '-3,2', val: -3.2, types: ['Q'] },
            { text: '2/3', val: 0.66, types: ['Q'] },
            { text: '75%', val: 0.75, types: ['Q'] },
            { text: 'œÄ', val: Math.PI, types: ['I'] },
            { text: '‚àö2', val: Math.sqrt(2), types: ['I'] },
            { text: '‚àö3', val: Math.sqrt(3), types: ['I'] },
            { text: 'e', val: Math.E, types: ['I'] },
            { text: 'œÜ', val: 1.618, types: ['I'] } 
        ];

        let currentRule = 'N';
        let ruleTimer = 0;
        const RULE_DURATION = 900; 

        let fallingNumbers = [];
        let particles = [];
        let isTouch = false;

        // Input Handling
        window.addEventListener('mousemove', (e) => {
            if (gameState === 'PLAYING') {
                player.targetX = e.clientX - player.width / 2;
            }
        });

        // Eventos Touch
        window.addEventListener('touchmove', (e) => {
            if (gameState === 'PLAYING') {
                isTouch = true;
                e.preventDefault(); 
                const touch = e.touches[0];
                player.targetX = touch.clientX - player.width / 2;
            }
        }, { passive: false });

        window.addEventListener('touchstart', (e) => {
            if (gameState === 'PLAYING') {
                const touch = e.touches[0];
                player.targetX = touch.clientX - player.width / 2;
            }
        }, { passive: false });

        // Fun√ß√µes Principais
        window.startGame = function() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            
            score = 0;
            lives = 3;
            fallingNumbers = [];
            particles = [];
            frameCount = 0;
            ruleTimer = RULE_DURATION;
            changeRule();
            
            resizeCanvas();
            player.x = canvas.width / 2 - player.width / 2;
            player.targetX = player.x;

            updateUI();
            
            gameState = 'PLAYING';
            if (animationId) cancelAnimationFrame(animationId);
            gameLoop();
        }

        function changeRule() {
            const keys = Object.keys(sets);
            let newRule;
            do {
                newRule = keys[Math.floor(Math.random() * keys.length)];
            } while (newRule === currentRule && keys.length > 1);
            
            currentRule = newRule;
            ruleTimer = RULE_DURATION;
            
            const ruleElement = document.getElementById('currentRuleDisplay');
            ruleElement.innerText = sets[currentRule].name;
            ruleElement.style.color = sets[currentRule].color;
            
            createExplosion(canvas.width/2, canvas.height/2, sets[currentRule].color, 20);
        }

        function spawnNumber() {
            const data = numberPool[Math.floor(Math.random() * numberPool.length)];
            const speedBase = 2 + (score / 50); 
            const speed = Math.min(speedBase, 8); 

            fallingNumbers.push({
                x: Math.random() * (canvas.width - 60) + 30,
                y: -50,
                text: data.text,
                types: data.types,
                speed: speed,
                radius: 25,
                color: '#FFF', 
                angle: (Math.random() - 0.5) * 0.5 
            });
        }

        function createExplosion(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color,
                    size: Math.random() * 5 + 2
                });
            }
        }

        function showFloatingText(text, x, y, color) {
            const el = document.createElement('div');
            el.className = 'float-text';
            el.innerText = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = color;
            el.style.fontSize = '24px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function updateUI() {
            document.getElementById('scoreDisplay').innerText = score;
            document.getElementById('livesDisplay').innerText = '‚ù§Ô∏è'.repeat(lives);
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            document.getElementById('gameUI').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.remove('hidden');
            document.getElementById('finalScore').innerText = score;
        }

        function gameLoop() {
            if (gameState !== 'PLAYING') return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ruleTimer--;
            const timerPercent = (ruleTimer / RULE_DURATION) * 100;
            document.getElementById('ruleTimerBar').style.width = `${timerPercent}%`;
            
            if (ruleTimer <= 0) {
                changeRule();
            }

            const spawnRate = Math.max(30, 80 - Math.floor(score / 5));
            if (frameCount % spawnRate === 0) {
                spawnNumber();
            }

            player.x += (player.targetX - player.x) * 0.2;
            
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.roundRect(player.x, player.y, player.width, player.height, 10);
            ctx.fill();
            
            ctx.strokeStyle = sets[currentRule].color;
            ctx.lineWidth = 3;
            ctx.stroke();

            for (let i = fallingNumbers.length - 1; i >= 0; i--) {
                let n = fallingNumbers[i];
                n.y += n.speed;
                n.angle += 0.01;

                ctx.save();
                ctx.translate(n.x, n.y);
                ctx.rotate(n.angle);
                
                let grad = ctx.createRadialGradient(0, 0, n.radius * 0.2, 0, 0, n.radius);
                grad.addColorStop(0, '#ffffff');
                grad.addColorStop(1, '#6366f1'); 
                
                ctx.beginPath();
                ctx.arc(0, 0, n.radius, 0, Math.PI * 2);
                ctx.fillStyle = grad;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.fillStyle = '#1e1b4b'; 
                ctx.font = 'bold 18px Fredoka';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(n.text, 0, 0);

                ctx.restore();

                if (
                    n.y + n.radius > player.y &&
                    n.y - n.radius < player.y + player.height &&
                    n.x > player.x &&
                    n.x < player.x + player.width
                ) {
                    const isCorrect = n.types.includes(currentRule);

                    if (isCorrect) {
                        score += 10;
                        showFloatingText("+10", player.x + player.width/2, player.y, '#4ade80');
                        createExplosion(n.x, n.y, '#4ade80');
                    } else {
                        lives--;
                        showFloatingText("Erro!", player.x + player.width/2, player.y, '#ef4444');
                        createExplosion(n.x, n.y, '#ef4444');
                        ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                        ctx.fillRect(0,0,canvas.width, canvas.height);
                    }
                    
                    updateUI();
                    fallingNumbers.splice(i, 1);

                    if (lives <= 0) {
                        gameOver();
                    }
                    continue;
                }

                if (n.y > canvas.height + 50) {
                    fallingNumbers.splice(i, 1);
                }
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                } else {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                }
            }

            frameCount++;
            animationId = requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
